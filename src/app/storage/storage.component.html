<div class="wms-page">
    <!-- Top cards -->
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <div class="stat-card st-a">
          <div class="stat-title">TOTAL SLOTS</div>
          <div class="stat-value">{{ totalSlots }}</div>
          <div class="stat-sub">zones: A / B / C</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card st-b">
          <div class="stat-title">OCCUPIED</div>
          <div class="stat-value">{{ occupiedCount }}</div>
          <div class="stat-sub">utilization</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card st-c">
          <div class="stat-title">PENDING</div>
          <div class="stat-value">{{ pendingCount }}</div>
          <div class="stat-sub">awaiting storage</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card st-d">
          <div class="stat-title">REJECTED</div>
          <div class="stat-value">{{ rejectedCount }}</div>
          <div class="stat-sub">needs review</div>
        </div>
      </div>
    </div>
  
    <div class="row g-3">
      <!-- Storage Map -->
      <div class="col-lg-8">
        <div class="card wms-card">
          <div class="card-header wms-card-header">
            <div class="hdr-left">
              <span class="dot"></span>
              <b>STORAGE MAP</b>
            </div>
  
            <div class="legend">
              <span class="lg"><i class="b occupied"></i> Occupied</span>
              <span class="lg"><i class="b partial"></i> Partial</span>
              <span class="lg"><i class="b empty"></i> Empty</span>
              <span class="lg"><i class="b rejected"></i> Rejected</span>
            </div>
          </div>
  
          <div class="card-body">
            <div *ngFor="let zr of zoneRows" class="zone-block">
              <div class="zone-title">{{ zr.title }}</div>
  
              <div class="slot-grid">
                <button
                  *ngFor="let s of slotsBy(zr.zone, zr.row)"
                  type="button"
                  [ngClass]="slotClass(s)"
                  (click)="onClickSlot(s)"
                  (mouseenter)="onHoverSlot(s)"
                  (mouseleave)="onHoverSlot(null)"
                >
                  <div class="slot-id">{{ s.id }}</div>
                  <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                  <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                </button>
              </div>
  
              <hr class="zone-sep" />
            </div>
  
            <!-- Selected slot table -->
            <div class="mt-3" *ngIf="selectedSlot">
              <div class="selected-title">
                Slot <b>{{ selectedSlot.id }}</b> materials
                <span class="badge badge-secondary ms-2">{{ selectedSlot.status }}</span>
              </div>
  
              <div class="table-wrap">
                <table class="table table-sm table-hover mb-0 wms-table">
                  <thead>
                    <tr>
                      <th>Material</th>
                      <th>Description</th>
                      <th>INV</th>
                      <th>Received</th>
                      <th class="text-end">Qty</th>
                      <th class="text-center">FIFO</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let m of selectedSlot.materials">
                      <td><b>{{ m.matCode }}</b></td>
                      <td class="muted">{{ m.description }}</td>
                      <td class="muted">{{ m.invNo }}</td>
                      <td class="muted">{{ m.receivedAt }}</td>
                      <td class="text-end"><b>{{ m.qty | number }}</b> {{ m.uom }}</td>
                      <td class="text-center">
                        <span class="badge badge-light">#{{ m.fifoRank }}</span>
                      </td>
                    </tr>
  
                    <tr *ngIf="!selectedSlot.materials.length">
                      <td colspan="6" class="text-center muted py-3">No material in this slot</td>
                    </tr>
                  </tbody>
                </table>
              </div>
  
              <!-- Hover preview (เหมือน tooltip ลอย) -->
              <div class="hover-preview" *ngIf="hoveredSlot && hoveredSlot.id === selectedSlot.id">
                <div class="hp-title">Preview</div>
                <div class="hp-line muted">hovered: {{ hoveredSlot.id }} • items: {{ hoveredSlot.materials.length }}</div>
              </div>
            </div>
  
          </div>
        </div>
      </div>
  
      <!-- Pending Area -->
      <div class="col-lg-4">
        <div class="card wms-card">
          <div class="card-header wms-card-header">
            <div class="hdr-left">
              <span class="dot warn"></span>
              <b>PENDING AREA</b>
            </div>
  
            <span class="pill">{{ pendingItems.length }} ITEMS</span>
          </div>
  
          <div class="card-body pending-body">
            <div *ngFor="let p of pendingItems" class="pending-item">
              <div class="pi-top">
                <div>
                  <div class="pi-title">{{ p.matCode }}</div>
                  <div class="pi-sub muted">{{ p.description }} • {{ p.invNo }} • {{ p.receivedAt }}</div>
                </div>
                <div class="pi-qty">
                  <b>{{ p.qty | number }}</b> {{ p.uom }}
                </div>
              </div>
  
              <div class="pi-tags">
                <span class="tag fifo"><i class="fas fa-bolt me-1"></i> FIFO #{{ p.fifoRank }} in queue</span>
                <span class="tag urgent" *ngIf="p.urgent">※ Urgent</span>
              </div>
  
              <div class="pi-actions">
                <button class="btn btn-sm btn-primary" (click)="openQuickStoreSwal(p)">
                  <i class="fas fa-dolly-flatbed me-1"></i> Store
                </button>
              </div>
            </div>
  
            <div *ngIf="!pendingItems.length" class="text-center muted py-3">
              No pending items
            </div>
          </div>
        </div>
      </div>
  
    </div>
  </div>