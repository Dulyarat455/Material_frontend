<div class="wms-page">
    <!-- Top cards -->
    <div class="row g-3 mb-3">
      <div class="col-md-3">
        <div class="stat-card st-a">
          <div class="stat-title">TOTAL SLOTS</div>
          <div class="stat-value">{{ totalSlots }}</div>
          <div class="stat-sub">zones: A / B / C</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card st-b">
          <div class="stat-title">OCCUPIED</div>
          <div class="stat-value">{{ occupiedCount }}</div>
          <div class="stat-sub">utilization</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card st-c">
          <div class="stat-title">PENDING</div>
          <div class="stat-value">{{ pendingCount }}</div>
          <div class="stat-sub">awaiting storage</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card st-d">
          <div class="stat-title">REJECTED</div>
          <div class="stat-value">{{ rejectedCount }}</div>
          <div class="stat-sub">needs review</div>
        </div>
      </div>
    </div>






  
    <div class="row g-3">
  <!-- MAP + PENDING แบบแปลน -->
  <div class="col-12">
    <div class="card wms-card">
      <div class="card-header wms-card-header">
        <div class="hdr-left">
          <span class="dot"></span>
          <b>STORAGE MAP</b>
        </div>

        <div class="legend">
          <span class="lg"><i class="b occupied"></i> Occupied</span>
          <span class="lg"><i class="b partial"></i> Partial</span>
          <span class="lg"><i class="b empty"></i> Empty</span>
          <span class="lg"><i class="b rejected"></i> Rejected</span>
        </div>
      </div>

      <div class="card-body">
        
        <!-- ====== FLOORPLAN GRID ====== -->
        <div class="floorplan">

       

            <!-- PENDING AREA (กล่องเดียว) -->
            <div class="fp-pending fp-pending-compact" (click)="onClickPendingArea()" role="button" tabindex="0">
              <div class="fp-title">
                <span class="dot warn"></span>
                <b>PENDING AREA</b>
                <span class="pill ms-2">{{ pendingItems.length }} ITEMS</span>
              </div>

              <div class="pending-hint muted">
                Click to view pending list
              </div>
            </div>



                        <!-- LEFT CLUSTER -->
              <div class="fp-left">

                <!-- BLOCK 1: 3201-3203 + 3101-3103 -->
                <div class="fp-block">
                  <div class="fp-block-head">
                    <span class="mini-pill">BTM</span>
                    <span class="mini-pill">TOP</span>
                  </div>

                  <div class="fp-two-col">
                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('A','BTM') | slice:0:3"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>

                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('B','TOP') | slice:0:3"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- BLOCK 2: 2101-2103 + 2201-2203 -->
                <div class="fp-block">
                  <div class="fp-block-head">
                    <span class="mini-pill">TOP</span>
                    <span class="mini-pill">BTM</span>
                  </div>

                  <div class="fp-two-col">
                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('C','TOP') | slice:0:3"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>

                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('C','BTM') | slice:0:3"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- BLOCK 3: 3204-3206 + 3104-3106 -->
                <div class="fp-block">
                  <div class="fp-block-head">
                    <span class="mini-pill">BTM</span>
                    <span class="mini-pill">TOP</span>
                  </div>

                  <div class="fp-two-col">
                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('A','BTM') | slice:3:6"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>

                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('B','TOP') | slice:3:6"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- BLOCK 4: 2104-2106 + 2204-2206 -->
                <div class="fp-block">
                  <div class="fp-block-head">
                    <span class="mini-pill">TOP</span>
                    <span class="mini-pill">BTM</span>
                  </div>

                  <div class="fp-two-col">
                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('C','TOP') | slice:3:6"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>

                    <div class="fp-col">
                      <button *ngFor="let s of slotsBy('C','BTM') | slice:3:6"
                        type="button" [ngClass]="slotClass(s)"
                        (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                        <div class="slot-id">{{ s.id }}</div>
                        <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                        <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                      </button>
                    </div>
                  </div>
                </div>

              </div>

              <!-- RIGHT COLUMN -->
              <div class="fp-right">
                <div class="fp-right-head">
                  <span class="mini-pill">BTM</span>
                  <span class="mini-pill">TOP</span>
                </div>

                <div class="fp-two-col">
                  <!-- 12xx (BTM) -->
                  <div class="fp-col">
                    <button *ngFor="let s of slotsBy('D','BTM')"
                      type="button" [ngClass]="slotClass(s)"
                      (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                      <div class="slot-id">{{ s.id }}</div>
                      <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                      <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                    </button>
                  </div>

                  <!-- 11xx (TOP) -->
                  <div class="fp-col">
                    <button *ngFor="let s of slotsBy('D','TOP')"
                      type="button" [ngClass]="slotClass(s)"
                      (click)="onClickSlot(s)" (mouseenter)="onHoverSlot(s)" (mouseleave)="onHoverSlot(null)">
                      <div class="slot-id">{{ s.id }}</div>
                      <div class="slot-qty" *ngIf="s.usedQty">{{ s.usedQty | number }}</div>
                      <div class="slot-qty empty-mark" *ngIf="!s.usedQty">—</div>
                    </button>
                  </div>
                </div>
              </div>



        </div>




            <!-- ======================
          TABLE AREA (2 modes)
          ====================== -->

            <!-- ✅ PENDING TABLE (รวมทั้งหมด) -->
            <div class="mt-3" *ngIf="viewMode === 'PENDING'">
              <div class="selected-title">
                Pending Area
                <span class="badge badge-secondary ms-2">PENDING • {{ pendingItems.length }} items</span>
              </div>

              <div class="table-wrap">
                <table class="table table-sm table-hover mb-0 wms-table">
                  <thead>
                    <tr>
                      <th>Material</th>
                      <th>Description</th>
                      <th>INV</th>
                      <th>Received</th>
                      <th class="text-end">Qty</th>
                      <th class="text-center">FIFO</th>
                      <th class="text-center">Action</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr *ngFor="let p of pendingItems">
                      <td><b>{{ p.matCode }}</b></td>
                      <td class="muted">{{ p.description }}</td>
                      <td class="muted">{{ p.invNo }}</td>
                      <td class="muted">{{ p.receivedAt }}</td>
                      <td class="text-end"><b>{{ p.qty | number }}</b> {{ p.uom }}</td>
                      <td class="text-center"><span class="badge badge-light">#{{ p.fifoRank }}</span></td>
                      <td class="text-center">
                        <button class="btn btn-sm btn-primary" (click)="openQuickStoreSwal(p)">
                          <i class="fas fa-dolly-flatbed me-1"></i> Store
                        </button>
                      </td>
                    </tr>

                    <tr *ngIf="!pendingItems.length">
                      <td colspan="7" class="text-center muted py-3">No pending items</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>


            <!-- Selected slot table (เหมือนเดิม) -->
            <div class="mt-3" *ngIf="selectedSlot">
              <div class="selected-title">
                Slot <b>{{ selectedSlot.id }}</b> materials
                <span class="badge badge-secondary ms-2">{{ selectedSlot.status }}</span>
              </div>

              <div class="table-wrap">
                <table class="table table-sm table-hover mb-0 wms-table">
                  <thead>
                  <tr>
                    <th>Material</th>
                    <th>Description</th>
                    <th>INV</th>
                    <th>Received</th>
                    <th class="text-end">Qty</th>
                    <th class="text-center">FIFO</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let m of selectedSlot.materials">
                    <td><b>{{ m.matCode }}</b></td>
                    <td class="muted">{{ m.description }}</td>
                    <td class="muted">{{ m.invNo }}</td>
                    <td class="muted">{{ m.receivedAt }}</td>
                    <td class="text-end"><b>{{ m.qty | number }}</b> {{ m.uom }}</td>
                    <td class="text-center"><span class="badge badge-light">#{{ m.fifoRank }}</span></td>
                  </tr>

                  <tr *ngIf="!selectedSlot.materials.length">
                    <td colspan="6" class="text-center muted py-3">No material in this slot</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>

      </div>
    </div>
  </div>
</div>






  </div>